<!DOCTYPE html>
<html>
<head>
    <title>Map Styles Information</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        .filters {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }

        .filter-input {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .styles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .style-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .style-card h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .metadata-item {
            margin-bottom: 10px;
        }

        .metadata-label {
            font-weight: bold;
            color: #666;
        }

        .metadata-value {
            margin-left: 10px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Map Styles Catalog</h1>
        
        <div class="filters">
            <input type="text" id="searchInput" class="filter-input" placeholder="Search by name or description...">
            <select id="authorFilter" class="filter-input">
                <option value="">All Authors</option>
            </select>
            <select id="licenseFilter" class="filter-input">
                <option value="">All Licenses</option>
            </select>
        </div>

        <div class="styles-grid" id="stylesContainer">
            <!-- Map styles will be inserted here -->
        </div>
    </div>

    <script>
        const mapFiles = [
            'maps/map_simplified_ign.json',
            'maps/map_aerial_photography_ign.json',
            'maps/map_simplified_osm-etalab.json',
            'maps/map_simplified_osm-world.json'
        ];

        let mapStyles = [];

        async function loadMapStyles() {
            try {
                const promises = mapFiles.map(file => 
                    fetch(file)
                        .then(response => response.json())
                        .catch(error => {
                            console.error(`Error loading ${file}:`, error);
                            return null;
                        })
                );

                const results = await Promise.all(promises);
                mapStyles = results.filter(style => style !== null);
                
                // Populate filter dropdowns
                populateFilterOptions();
                
                // Initial display
                displayMapStyles();

            } catch (error) {
                console.error('Error loading map styles:', error);
                document.getElementById('stylesContainer').innerHTML = 
                    '<p>Error loading map styles</p>';
            }
        }

        function populateFilterOptions() {
            const authors = new Set();
            const licenses = new Set();

            mapStyles.forEach(style => {
                if (style.metadata?.author) authors.add(style.metadata.author);
                if (style.metadata?.license) licenses.add(style.metadata.license);
            });

            const authorSelect = document.getElementById('authorFilter');
            const licenseSelect = document.getElementById('licenseFilter');

            authors.forEach(author => {
                const option = document.createElement('option');
                option.value = author;
                option.textContent = author;
                authorSelect.appendChild(option);
            });

            licenses.forEach(license => {
                const option = document.createElement('option');
                option.value = license;
                option.textContent = license;
                licenseSelect.appendChild(option);
            });
        }

        function createStyleCard(style) {
            const metadata = style.metadata || {};
            
            const card = document.createElement('div');
            card.className = 'style-card';

            const metadataItems = [
                { label: 'Name', value: style.name },
                { label: 'Description', value: metadata.description },
                { label: 'Usage', value: metadata.usage },
                { label: 'Version', value: metadata.version },
                { label: 'Author', value: metadata.author },
                { label: 'Contact', value: metadata.contact },
                { label: 'License', value: metadata.license },
                { label: 'Attribution', value: metadata.attribution },
                { label: 'Zoom Levels', value: `${metadata.minzoom || 0} to ${metadata.maxzoom || 'max'}` }
            ];

            const content = metadataItems
                .filter(item => item.value)
                .map(item => `
                    <div class="metadata-item">
                        <span class="metadata-label">${item.label}:</span>
                        <span class="metadata-value">${item.value}</span>
                    </div>
                `)
                .join('');

            card.innerHTML = `<h2>${style.name}</h2>${content}`;
            return card;
        }

        function filterStyles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedAuthor = document.getElementById('authorFilter').value;
            const selectedLicense = document.getElementById('licenseFilter').value;

            const container = document.getElementById('stylesContainer');
            container.innerHTML = '';

            mapStyles.forEach(style => {
                const metadata = style.metadata || {};
                
                const matchesSearch = (style.name?.toLowerCase().includes(searchTerm) || 
                                     metadata.description?.toLowerCase().includes(searchTerm));
                const matchesAuthor = !selectedAuthor || metadata.author === selectedAuthor;
                const matchesLicense = !selectedLicense || metadata.license === selectedLicense;

                if (matchesSearch && matchesAuthor && matchesLicense) {
                    container.appendChild(createStyleCard(style));
                }
            });
        }

        function displayMapStyles() {
            filterStyles();
        }

        // Event listeners for filters
        document.getElementById('searchInput').addEventListener('input', filterStyles);
        document.getElementById('authorFilter').addEventListener('change', filterStyles);
        document.getElementById('licenseFilter').addEventListener('change', filterStyles);

        // Load the map styles when the page loads
        loadMapStyles();
    </script>
</body>
</html>